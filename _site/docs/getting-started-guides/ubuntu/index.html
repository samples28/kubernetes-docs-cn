

<!Doctype html>
<html id="docs">


<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="shortcut icon" type="image/png" href="/images/favicon.png">
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Roboto+Mono' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/css/styles.css"/>
	<script src="/js/jquery-2.2.0.min.js"></script>
	<script src="/js/script.js"></script>
	<title>Kubernetes - Ubuntu</title>
</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs/" class="button" id="viewDocs">View Documentation</a>
		<a href="/docs/hellonode/" class="button" id="tryKubernetes">Try Kubernetes</a>
		<button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="/docs/hellonode/">Get Started</a></h3>
				<p>Built for a multi-cloud world, public, private or hybrid. Seamlessly roll out new features.</p>
			</div>
			<div class="nav-box">
				<h3><a href="/docs/">Documentation</a></h3>
				<p>Pellentesque in ipsum id orci porta dapibus. Nulla porttitor accumsan tincidunt. </p>
			</div>
			<div class="nav-box">
				<h3><a href="/community/">Community</a></h3>
				<p>Vestibulum ac diam sit amet quam vehicula elementum sed sit amet dui. </p>
			</div>
			<div class="nav-box">
				<h3><a href="http://blog.kubernetes.io">Blog</a></h3>
				<p>Curabitur arcu erat, accumsan id imperdiet et, porttitor at sem. Quisque velit nisi, pretium ut lacinia in. </p>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="left">
				<h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
				<a href="" class="button">View On Github</a>
			</div>

			<div class="right">
				<h5 class="github-invite">Explore the community</h5>
				<div class="social">
					<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
					<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
					<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
					<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
					<a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
	<h1>Guides</h1>
	<h5>How to get started, and acheive tasks, using Kubernetes</h5>
	<div id="vendorStrip" class="light-text">
		<ul>
			<li><a href="/docs/">GUIDES</a></li>
			<li><a href="/docs/reference">REFERENCE</a></li>
			<li><a href="/docs/samples">SAMPLES</a></li>
			<li><a href="/docs/troubleshooting/">SUPPORT</a></li>
		</ul><!--
		<div class="dropdown">
			<div class="readout"></div>
			<a href="/v1.1/">Version 1.1</a>
            <a href="/v1.2/">Version 1.2</a>
		</div>-->
		<input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)">
	</div>
</section>

<section id="encyclopedia">
	<div id="docsToc">
        <div class="pi-accordion">
        
    <a class="item" data-title="Guides" href="/docs/"></a>
<div class="item" data-title="Getting Started">
  <div class="container">
    <a class="item" data-title="What is Kubernetes?" href="/docs/whatisk8s/"></a>
    <a class="item" data-title="Downloading Kubernetes" href="/docs/getting-started-guides/binary_release/"></a>
    <a class="item" data-title="Hello World Walkthrough" href="/docs/hellonode/"></a>
    <a class="item" data-title="Kubernetes 101" href="/docs/user-guide/walkthrough/"></a>
    <a class="item" data-title="Kubernetes 201" href="/docs/user-guide/walkthrough/k8s201/"></a>
  </div>
</div>
    <a class="item" data-title="User Guide" href="/docs/user-guide/"></a>
    <a class="item" data-title="Admin Guide" href="/docs/admin/"></a>
<div class="item" data-title="Running Kubernetes">
  <div class="container">
    <a class="item" data-title="Picking the Right Solution" href="/docs/getting-started-guides/"></a>
<div class="item" data-title="Running Kubernetes on Your Local Machine">
  <div class="container">
    <a class="item" data-title="Running Kubernetes Locally via Docker" href="/docs/getting-started-guides/docker/"></a>
    <a class="item" data-title="Running Kubernetes Locally via Vagrant" href="/docs/getting-started-guides/vagrant/"></a>
    <a class="item" data-title="Running Kubernetes Locally with No VM" href="/docs/getting-started-guides/locally/"></a>
  </div>
</div>
<div class="item" data-title="Running Kubernetes on Turn-key Cloud Solutions">
  <div class="container">
    <a class="item" data-title="Running Kubernetes on Google Container Engine" href="https://cloud.google.com/container-engine/docs/before-you-begin/" target='_blank'></a>
    <a class="item" data-title="Running Kubernetes on Google Compute Engine" href="/docs/getting-started-guides/gce/"></a>
    <a class="item" data-title="Running Kubernetes on AWS EC2" href="/docs/getting-started-guides/aws/"></a>
    <a class="item" data-title="Running Kubernetes on Azure" href="/docs/getting-started-guides/coreos/azure/"></a>
  </div>
</div>
<div class="item" data-title="Running Kubernetes on Custom Solutions">
  <div class="container">
    <a class="item" data-title="Getting Started From Scratch" href="/docs/getting-started-guides/scratch/"></a>
<div class="item" data-title="Custom Cloud Solutions">
  <div class="container">
    <a class="item" data-title="AWS or GCE on CoreOS" href="/docs/getting-started-guides/coreos/"></a>
    <a class="item" data-title="AWS or Joyent on Ubuntu" href="/docs/getting-started-guides/juju/"></a>
    <a class="item" data-title="Rackspace on CoreOS" href="/docs/getting-started-guides/rackspace/"></a>
  </div>
</div>
<div class="item" data-title="On-Premise VMs">
  <div class="container">
    <a class="item" data-title="Vagrant or VMware" href="/docs/getting-started-guides/coreos/"></a>
    <a class="item" data-title="Cloudstack" href="/docs/getting-started-guides/cloudstack/"></a>
    <a class="item" data-title="VMWare" href="/docs/getting-started-guides/vsphere/"></a>
    <a class="item" data-title="Juju" href="/docs/getting-started-guides/juju/"></a>
    <a class="item" data-title="DCOS" href="/docs/getting-started-guides/dcos/"></a>
    <a class="item" data-title="libvirt on CoreOS" href="/docs/getting-started-guides/libvirt-coreos/"></a>
    <a class="item" data-title="oVirt" href="/docs/getting-started-guides/ovirt/"></a>
    <a class="item" data-title="libvirt or KVM" href="/docs/getting-started-guides/fedora/flannel_multi_node_cluster/"></a>
    <a class="item" data-title="Multinode Cluster on CoreOS" href="/docs/getting-started-guides/coreos/coreos_multinode_cluster/"></a>
    <a class="item" data-title="Fedora With Calico Networking" href="/docs/getting-started-guides/fedora/fedora-calico/"></a>
    <a class="item" data-title="rkt" href="/docs/getting-started-guides/rkt/"></a>
    <a class="item" data-title="Kubernetes on Mesos" href="/docs/getting-started-guides/mesos/"></a>
    <a class="item" data-title="Kubernetes on Mesos on Docker" href="/docs/getting-started-guides/mesos-docker/"></a>
  </div>
</div>
<div class="item" data-title="Bare Metal">
  <div class="container">
    <a class="item" data-title="Offline" href="/docs/getting-started-guides/coreos/bare_metal_offline/"></a>
    <a class="item" data-title="Fedora via Ansible" href="/docs/getting-started-guides/fedora/fedora_ansible_config/"></a>
    <a class="item" data-title="Fedora (Single Node)" href="/docs/getting-started-guides/fedora/fedora_manual_config/"></a>
    <a class="item" data-title="Fedora (Multi Node)" href="/docs/getting-started-guides/fedora/flannel_multi_node_cluster/"></a>
    <a class="item" data-title="Centos" href="/docs/getting-started-guides/centos/centos_manual_config/"></a>
    <a class="item" data-title="Ubuntu" href="/docs/getting-started-guides/ubuntu/"></a>
    <a class="item" data-title="Docker (Multi-Node)" href="/docs/getting-started-guides/docker-multinode/"></a>
    <a class="item" data-title="CoreOS with Calico" href="/docs/getting-started-guides/coreos/bare_metal_calico/"></a>
    <a class="item" data-title="Ubuntu Nodes with Calico" href="/docs/getting-started-guides/ubuntu-calico/"></a>
  </div>
</div>
  </div>
</div>
  </div>
</div>
<div class="item" data-title="Administering Clusters">
  <div class="container">
    <a class="item" data-title="Cluster Management Guide" href="/docs/admin/cluster-management/"></a>
    <a class="item" data-title="Anatomy of a Cluster" href="/docs/admin/cluster-components/"></a>
    <a class="item" data-title="Using Multiple Clusters" href="/docs/admin/multi-cluster/"></a>
    <a class="item" data-title="Using Large Clusters" href="/docs/admin/cluster-large/"></a>
    <a class="item" data-title="Building High-Availability Clusters" href="/docs/admin/high-availability/"></a>
    <a class="item" data-title="Accessing Clusters" href="/docs/user-guide/accessing-the-cluster/"></a>
    <a class="item" data-title="Sharing a Cluster" href="/docs/admin/namespaces/"></a>
    <a class="item" data-title="Changing Cluster Size" href="https://github.com/kubernetes/kubernetes/wiki/User-FAQ#how-do-i-change-the-size-of-my-cluster/" target='_blank'></a>
    <a class="item" data-title="Creating a Custom Cluster from Scratch" href="/docs/getting-started-guides/scratch/"></a>
    <a class="item" data-title="Authenticating Across Clusters with kubeconfig" href="/docs/user-guide/kubeconfig-file/"></a>
  </div>
</div>
<div class="item" data-title="Using Nodes, Pods, and Containers">
  <div class="container">
    <a class="item" data-title="The Container Environment" href="/docs/user-guide/container-environment/"></a>
    <a class="item" data-title="Running Your First Containers" href="/docs/user-guide/simple-nginx/"></a>
    <a class="item" data-title="Working with Containers" href="/docs/user-guide/production-pods/"></a>
    <a class="item" data-title="Overriding Default Container Behavior" href="/docs/user-guide/containers/"></a>
    <a class="item" data-title="Running Commands in a Container with kubectl exec" href="/docs/user-guide/getting-into-containers/"></a>
    <a class="item" data-title="The Lifecycle of a Pod" href="/docs/user-guide/pod-states/"></a>
    <a class="item" data-title="Assigning Pods to Nodes" href="/docs/user-guide/node-selection/"></a>
    <a class="item" data-title="Creating Pods with the Downward API" href="/docs/user-guide/downward-api/"></a>
    <a class="item" data-title="Updating Live Pods" href="/docs/user-guide/update-demo/"></a>
    <a class="item" data-title="Installing a Kubernetes Master Node via Docker" href="/docs/getting-started-guides/docker-multinode/master/"></a>
    <a class="item" data-title="Adding a Kubernetes Worker Node via Docker" href="/docs/getting-started-guides/docker-multinode/worker/"></a>
  </div>
</div>
<div class="item" data-title="Networking">
  <div class="container">
    <a class="item" data-title="Networking in Kubernetes" href="/docs/admin/networking/"></a>
    <a class="item" data-title="Using DNS Pods and Services" href="/docs/admin/dns/"></a>
    <a class="item" data-title="Setting Up and Configuring DNS" href="https://github.com/kubernetes/kubernetes/tree/release-1.1/examples/cluster-dns" target='_blank'></a>
    <a class="item" data-title="Deploying DNS" href="/docs/getting-started-guides/docker-multinode/deployDNS/"></a>
    <a class="item" data-title="Connecting Applications" href="/docs/user-guide/connecting-applications/"></a>
    <a class="item" data-title="Creating Servers with External IPs" href="https://github.com/kubernetes/kubernetes/blob/release-1.1/examples/simple-nginx.md" target='_blank'></a>
    <a class="item" data-title="Connect with Proxies" href="/docs/user-guide/connecting-to-applications-proxy/"></a>
    <a class="item" data-title="Connect with Port Forwarding" href="/docs/user-guide/connecting-to-applications-port-forward/"></a>
    <a class="item" data-title="Configuring Your Cloud Provider's Firewalls" href="/docs/user-guide/services-firewalls/"></a>
  </div>
</div>
<div class="item" data-title="Configuring Kubernetes">
  <div class="container">
    <a class="item" data-title="Using Configuration Files" href="/docs/user-guide/simple-yaml/"></a>
    <a class="item" data-title="Best Practices for Configuration" href="/docs/user-guide/config-best-practices/"></a>
    <a class="item" data-title="Configuring Containers" href="/docs/user-guide/configuring-containers/"></a>
    <a class="item" data-title="Sharing Cluster Access with kubeconfig" href="/docs/user-guide/sharing-clusters/"></a>
    <a class="item" data-title="Using Environment Variables" href="/docs/user-guide/environment-guide/"></a>
    <a class="item" data-title="Managing Compute Resources" href="/docs/user-guide/compute-resources/"></a>
    <a class="item" data-title="Using kubectl to Manage Resources" href="/docs/user-guide/working-with-resources/"></a>
    <a class="item" data-title="Applying Resource Quotas and Limits" href="/docs/admin/resourcequota/"></a>
    <a class="item" data-title="Setting Pod CPU and Memory Limits" href="/docs/admin/limitrange/"></a>
    <a class="item" data-title="Configuring Garbage Collection" href="/docs/admin/garbage-collection/"></a>
    <a class="item" data-title="Configuring Kubernetes with Salt" href="/docs/admin/salt/"></a>
    <a class="item" data-title="Configuring Kubernetes Use of etcd" href="/docs/admin/etcd/"></a>
  </div>
</div>
<div class="item" data-title="Application Management and Deployment">
  <div class="container">
    <a class="item" data-title="Managing Applications: Prerequisites" href="/docs/user-guide/prereqs/"></a>
    <a class="item" data-title="Managing Deployments" href="/docs/user-guide/managing-deployments/"></a>
    <a class="item" data-title="Deploying Applications" href="/docs/user-guide/deploying-applications/"></a>
    <a class="item" data-title="Launching, Exposing, and Killing Applications" href="/docs/user-guide/quick-start/"></a>
  </div>
</div>
<div class="item" data-title="Testing and Monitoring">
  <div class="container">
    <a class="item" data-title="Testing a Kubernetes Cluster" href="/docs/getting-started-guides/docker-multinode/testing/"></a>
    <a class="item" data-title="Simulating Large Test Loads" href="https://github.com/kubernetes/kubernetes/tree/release-1.1/examples/k8petstore" target='_blank'></a>
    <a class="item" data-title="Checking Pod Health" href="/docs/user-guide/liveness/"></a>
    <a class="item" data-title="Using Explorer to Examine the Runtime Environment" href="https://github.com/kubernetes/kubernetes/tree/release-1.1/examples/explorer" target='_blank'></a>
    <a class="item" data-title="Resource Usage Monitoring" href="/docs/user-guide/monitoring/"></a>
    <a class="item" data-title="Logging" href="/docs/getting-started-guides/logging/"></a>
    <a class="item" data-title="Logging with Elasticsearch and Kibana" href="/docs/getting-started-guides/logging-elasticsearch/"></a>
  </div>
</div>
        </div> <!-- /pi-accordion -->
	</div> <!-- /docsToc -->
	<div id="docsContent">
        <p><a href="/docs/editdocs#docs/getting-started-guides/ubuntu.md" id="editPageButton">Edit This Page</a></p>
    	<h1>Ubuntu</h1>
		<p>This document describes how to deploy kubernetes on ubuntu nodes, 1 master and 3 nodes involved
in the given examples. You can scale to <strong>any number of nodes</strong> by changing some settings with ease.
The original idea was heavily inspired by @jainvipin ‘s ubuntu single node
work, which has been merge into this document.</p>

<p><a href="https://github.com/ZJU-SEL">Cloud team from Zhejiang University</a> will maintain this work.</p>

<ul id="markdown-toc">
  <li><a href="#prerequisites" id="markdown-toc-prerequisites">Prerequisites</a></li>
  <li><a href="#starting-a-cluster" id="markdown-toc-starting-a-cluster">Starting a Cluster</a>    <ul>
      <li><a href="#download-binaries" id="markdown-toc-download-binaries">Download binaries</a>        <ul>
          <li><a href="#configure-and-start-the-kubernetes-cluster" id="markdown-toc-configure-and-start-the-kubernetes-cluster">Configure and start the Kubernetes cluster</a></li>
        </ul>
      </li>
      <li><a href="#test-it-out" id="markdown-toc-test-it-out">Test it out</a></li>
      <li><a href="#deploy-addons" id="markdown-toc-deploy-addons">Deploy addons</a></li>
      <li><a href="#on-going" id="markdown-toc-on-going">On going</a></li>
      <li><a href="#trouble-shooting" id="markdown-toc-trouble-shooting">Trouble shooting</a></li>
      <li><a href="#upgrading-a-cluster" id="markdown-toc-upgrading-a-cluster">Upgrading a Cluster</a></li>
    </ul>
  </li>
</ul>

<h2 id="prerequisites">Prerequisites</h2>

<ol>
  <li>The nodes have installed docker version 1.2+ and bridge-utils to manipulate linux bridge.</li>
  <li>All machines can communicate with each other. Master node needs to connect the Internet to download the necessary files, while working nodes do not.</li>
  <li>These guide is tested OK on Ubuntu 14.04 LTS 64bit server, but it can not work with
Ubuntu 15 which use systemd instead of upstart. We are working around fixing this.</li>
  <li>Dependencies of this guide: etcd-2.0.12, flannel-0.4.0, k8s-1.0.3, may work with higher versions.</li>
  <li>All the remote servers can be ssh logged in without a password by using key authentication.</li>
</ol>

<h2 id="starting-a-cluster">Starting a Cluster</h2>

<h3 id="download-binaries">Download binaries</h3>

<p>First clone the kubernetes github repo</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>git clone https://github.com/kubernetes/kubernetes.git
</code></pre>
</div>

<p>Then download all the needed binaries into given directory (cluster/ubuntu/binaries)</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">cd </span>kubernetes/cluster/ubuntu
<span class="gp">$ </span>./build.sh
</code></pre>
</div>

<p>You can customize your etcd version, flannel version, k8s version by changing corresponding variables
<code class="highlighter-rouge">ETCD_VERSION</code> , <code class="highlighter-rouge">FLANNEL_VERSION</code> and <code class="highlighter-rouge">KUBE_VERSION</code> in build.sh, by default etcd version is 2.0.12,
flannel version is 0.4.0 and k8s version is 1.0.3.</p>

<p>Make sure that the involved binaries are located properly in the binaries/master
or binaries/minion directory before you go ahead to the next step .</p>

<p>Note that we use flannel here to set up overlay network, yet it’s optional. Actually you can build up k8s
cluster natively, or use flannel, Open vSwitch or any other SDN tool you like.</p>

<h4 id="configure-and-start-the-kubernetes-cluster">Configure and start the Kubernetes cluster</h4>

<p>An example cluster is listed below:</p>

<table>
  <thead>
    <tr>
      <th>IP Address</th>
      <th>Role</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>10.10.103.223</td>
      <td>node</td>
    </tr>
    <tr>
      <td>10.10.103.162</td>
      <td>node</td>
    </tr>
    <tr>
      <td>10.10.103.250</td>
      <td>both master and node</td>
    </tr>
  </tbody>
</table>

<p>First configure the cluster information in cluster/ubuntu/config-default.sh, below is a simple sample.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nb">export </span><span class="nv">nodes</span><span class="o">=</span><span class="s2">"vcap@10.10.103.250 vcap@10.10.103.162 vcap@10.10.103.223"</span>

<span class="nb">export </span><span class="nv">role</span><span class="o">=</span><span class="s2">"ai i i"</span>

<span class="nb">export </span><span class="nv">NUM_MINIONS</span><span class="o">=</span><span class="k">${</span><span class="nv">NUM_MINIONS</span><span class="k">:-</span><span class="nv">3</span><span class="k">}</span>

<span class="nb">export </span><span class="nv">SERVICE_CLUSTER_IP_RANGE</span><span class="o">=</span>192.168.3.0/24

<span class="nb">export </span><span class="nv">FLANNEL_NET</span><span class="o">=</span>172.16.0.0/16
</code></pre>
</div>

<p>The first variable <code class="highlighter-rouge">nodes</code> defines all your cluster nodes, MASTER node comes first and
separated with blank space like <code class="highlighter-rouge">&lt;user_1@ip_1&gt; &lt;user_2@ip_2&gt; &lt;user_3@ip_3&gt; </code></p>

<p>Then the <code class="highlighter-rouge">role</code> variable defines the role of above machine in the same order, “ai” stands for machine
acts as both master and node, “a” stands for master, “i” stands for node.</p>

<p>The <code class="highlighter-rouge">NUM_MINIONS</code> variable defines the total number of nodes.</p>

<p>The <code class="highlighter-rouge">SERVICE_CLUSTER_IP_RANGE</code> variable defines the kubernetes service IP range. Please make sure
that you do have a valid private ip range defined here, because some IaaS provider may reserve private ips.
You can use below three private network range according to rfc1918. Besides you’d better not choose the one
that conflicts with your own private network range.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>10.0.0.0        -   10.255.255.255  <span class="o">(</span>10/8 prefix<span class="o">)</span>

172.16.0.0      -   172.31.255.255  <span class="o">(</span>172.16/12 prefix<span class="o">)</span>

192.168.0.0     -   192.168.255.255 <span class="o">(</span>192.168/16 prefix<span class="o">)</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">FLANNEL_NET</code> variable defines the IP range used for flannel overlay network,
should not conflict with above <code class="highlighter-rouge">SERVICE_CLUSTER_IP_RANGE</code>.</p>

<p><strong>Note:</strong> When deploying, master needs to connect the Internet to download the necessary files. If your machines locate in a private network that need proxy setting to connect the Internet, you can set the config <code class="highlighter-rouge">PROXY_SETTING</code> in cluster/ubuntu/config-default.sh such as:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">PROXY_SETTING</span><span class="o">=</span><span class="s2">"http_proxy=http://server:port https_proxy=https://server:port"</span>
</code></pre>
</div>

<p>After all the above variables being set correctly, we can use following command in cluster/ directory to bring up the whole cluster.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">KUBERNETES_PROVIDER</span><span class="o">=</span>ubuntu ./kube-up.sh
</code></pre>
</div>

<p>The scripts automatically scp binaries and config files to all the machines and start the k8s service on them.
The only thing you need to do is to type the sudo password when promoted.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Deploying minion on machine 10.10.103.223
...
<span class="o">[</span>sudo] password to copy files and start minion: 
</code></pre>
</div>

<p>If all things goes right, you will see the below message from console indicating the k8s is up.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Cluster validation succeeded
</code></pre>
</div>

<h3 id="test-it-out">Test it out</h3>

<p>You can use <code class="highlighter-rouge">kubectl</code> command to check if the newly created k8s is working correctly.
The <code class="highlighter-rouge">kubectl</code> binary is under the <code class="highlighter-rouge">cluster/ubuntu/binaries</code> directory.
You can make it available via PATH, then you can use the below command smoothly.</p>

<p>For example, use <code class="highlighter-rouge">$ kubectl get nodes</code> to see if all of your nodes are ready.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl get nodes
NAME            LABELS                                 STATUS
10.10.103.162   kubernetes.io/hostname<span class="o">=</span>10.10.103.162   Ready
10.10.103.223   kubernetes.io/hostname<span class="o">=</span>10.10.103.223   Ready
10.10.103.250   kubernetes.io/hostname<span class="o">=</span>10.10.103.250   Ready
</code></pre>
</div>

<p>Also you can run Kubernetes <a href="https://github.com/kubernetes/kubernetes/tree/release-1.1/examples/guestbook/">guest-example</a> to build a redis backend cluster on the k8s．</p>

<h3 id="deploy-addons">Deploy addons</h3>

<p>Assuming you have a starting cluster now, this section will tell you how to deploy addons like DNS
and UI onto the existing cluster.</p>

<p>The configuration of DNS is configured in cluster/ubuntu/config-default.sh.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">ENABLE_CLUSTER_DNS</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">KUBE_ENABLE_CLUSTER_DNS</span><span class="k">:-</span><span class="nv">true</span><span class="k">}</span><span class="s2">"</span>

<span class="nv">DNS_SERVER_IP</span><span class="o">=</span><span class="s2">"192.168.3.10"</span>

<span class="nv">DNS_DOMAIN</span><span class="o">=</span><span class="s2">"cluster.local"</span>

<span class="nv">DNS_REPLICAS</span><span class="o">=</span>1
</code></pre>
</div>

<p>The <code class="highlighter-rouge">DNS_SERVER_IP</code> is defining the ip of dns server which must be in the <code class="highlighter-rouge">SERVICE_CLUSTER_IP_RANGE</code>.
The <code class="highlighter-rouge">DNS_REPLICAS</code> describes how many dns pod running in the cluster.</p>

<p>By default, we also take care of kube-ui addon.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">ENABLE_CLUSTER_UI</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">KUBE_ENABLE_CLUSTER_UI</span><span class="k">:-</span><span class="nv">true</span><span class="k">}</span><span class="s2">"</span>
</code></pre>
</div>

<p>After all the above variables have been set, just type the following command.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">cd </span>cluster/ubuntu
<span class="gp">$ </span><span class="nv">KUBERNETES_PROVIDER</span><span class="o">=</span>ubuntu ./deployAddons.sh
</code></pre>
</div>

<p>After some time, you can use <code class="highlighter-rouge">$ kubectl get pods --namespace=kube-system</code> to see the DNS and UI pods are running in the cluster.</p>

<h3 id="on-going">On going</h3>

<p>We are working on these features which we’d like to let everybody know:</p>

<ol>
  <li>Run kubernetes binaries in Docker using <a href="https://github.com/ZJU-SEL/kube-in-docker/tree/baremetal-kube">kube-in-docker</a>,
to eliminate OS-distro differences.</li>
  <li>Tearing Down scripts: clear and re-create the whole stack by one click.</li>
</ol>

<h3 id="trouble-shooting">Trouble shooting</h3>

<p>Generally, what this approach does is quite simple:</p>

<ol>
  <li>Download and copy binaries and configuration files to proper directories on every node</li>
  <li>Configure <code class="highlighter-rouge">etcd</code> using IPs based on input from user</li>
  <li>Create and start flannel network</li>
</ol>

<p>So if you encounter a problem, <strong>check etcd configuration first</strong></p>

<p>Please try:</p>

<ol>
  <li>Check <code class="highlighter-rouge">/var/log/upstart/etcd.log</code> for suspicious etcd log</li>
  <li>Check <code class="highlighter-rouge">/etc/default/etcd</code>, as we do not have much input validation, a right config should be like:</li>
</ol>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">ETCD_OPTS</span><span class="o">=</span><span class="s2">"-name infra1 -initial-advertise-peer-urls &lt;http://ip_of_this_node:2380&gt; -listen-peer-urls &lt;http://ip_of_this_node:2380&gt; -initial-cluster-token etcd-cluster-1 -initial-cluster infra1=&lt;http://ip_of_this_node:2380&gt;,infra2=&lt;http://ip_of_another_node:2380&gt;,infra3=&lt;http://ip_of_another_node:2380&gt; -initial-cluster-state new"</span>
</code></pre>
</div>

<ol>
  <li>You may find following commands useful, the former one to bring down the cluster, while
the latter one could start it again.</li>
</ol>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">KUBERNETES_PROVIDER</span><span class="o">=</span>ubuntu ./kube-down.sh
<span class="nv">KUBERNETES_PROVIDER</span><span class="o">=</span>ubuntu ./kube-up.sh
</code></pre>
</div>

<ol>
  <li>You can also customize your own settings in <code class="highlighter-rouge">/etc/default/{component_name}</code>.</li>
</ol>

<h3 id="upgrading-a-cluster">Upgrading a Cluster</h3>

<p>If you already have a kubernetes cluster, and want to upgrade to a new version,
you can use following command in cluster/ directory to update the whole cluster or a specified node to a new version.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">KUBERNETES_PROVIDER</span><span class="o">=</span>ubuntu ./kube-push.sh <span class="o">[</span>-m|-n &lt;node id&gt;] &lt;version&gt;
</code></pre>
</div>

<p>It can be done for all components (by default), master(<code class="highlighter-rouge">-m</code>) or specified node(<code class="highlighter-rouge">-n</code>).
If the version is not specified, the script will try to use local binaries.You should ensure all the binaries are well prepared in path <code class="highlighter-rouge">cluster/ubuntu/binaries</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>tree cluster/ubuntu/binaries
binaries/
<span class="s1">'��'</span>��<span class="s1">'�� kubectl
'</span>��<span class="s1">'��'</span>�� master
<span class="s1">'��   '</span>��<span class="s1">'��'</span>�� etcd
<span class="s1">'��   '</span>��<span class="s1">'��'</span>�� etcdctl
<span class="s1">'��   '</span>��<span class="s1">'��'</span>�� flanneld
<span class="s1">'��   '</span>��<span class="s1">'��'</span>�� kube-apiserver
<span class="s1">'��   '</span>��<span class="s1">'��'</span>�� kube-controller-manager
<span class="s1">'��   '</span>��<span class="s1">'��'</span>�� kube-scheduler
<span class="s1">'��'</span>��<span class="s1">'�� minion
    '</span>��<span class="s1">'��'</span>�� flanneld
    <span class="s1">'��'</span>��<span class="s1">'�� kubelet
    '</span>��<span class="s1">'��'</span>�� kube-proxy
</code></pre>
</div>

<p>Upgrading single node is experimental now. You can use following command to get a help.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">KUBERNETES_PROVIDER</span><span class="o">=</span>ubuntu ./kube-push.sh -h
</code></pre>
</div>

<p>Some examples are as follows:</p>

<ul>
  <li>upgrade master to version 1.0.5: <code class="highlighter-rouge">$ KUBERNETES_PROVIDER=ubuntu ./kube-push.sh -m 1.0.5</code></li>
  <li>upgrade node 10.10.103.223 to version 1.0.5 : <code class="highlighter-rouge">$ KUBERNETES_PROVIDER=ubuntu ./kube-push.sh -n 10.10.103.223 1.0.5</code></li>
  <li>upgrade master and all nodes to version 1.0.5: <code class="highlighter-rouge">$ KUBERNETES_PROVIDER=ubuntu ./kube-push.sh 1.0.5</code></li>
</ul>

<p>The script will not delete any resources of your cluster, it just replaces the binaries.
You can use <code class="highlighter-rouge">kubectl</code> command to check if the newly upgraded k8s is working correctly.
For example, use <code class="highlighter-rouge">$ kubectl get nodes</code> to see if all of your nodes are ready.Or refer to <a href="/docs/getting-started-guides/ubuntu/#test-it-out">test-it-out</a></p>

        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/getting-started-guides/ubuntu.md?pixel" alt="Analytics" /></a>
        <div id="pd_rating_holder_8345992"></div>
		<script type="text/javascript">
        PDRTJS_settings_8345992 = {
        "id" : "8345992",
        "unique_id" : "/docs/getting-started-guides/ubuntu/",
        "title" : "Ubuntu",
        "permalink" : "http://kubernetes.github.io/docs/getting-started-guides/ubuntu/"
        };
        (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
        </script>
	</div>
</section>

<footer>
	<main class="light-text">
		<nav>
			<a href="/docs/hellonode/">Get Started</a>
			<a href="/docs/">Documentation</a>
			<a href="http://blog.kubernetes.io/">Blog</a>
			<a href="/community/">Community</a>
		</nav>
		<div class="social">
			<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
			<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
			<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
			<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
			<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
			<a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
			<label for="wishField">I wish this page <input type="text" id="wishField" name="wishField" placeholder="enter your wish"></label>
		</div>
		<div class="center">&copy; 2016 Kubernetes</div>
	</main>
</footer>



<style>
	.cse .gsc-control-cse, .gsc-control-cse {
		padding: 0;
	}

	.gsc-above-wrapper-area {
		border-bottom: 0;
	}
</style>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-36037335-10', 'auto');
  ga('send', 'pageview');
</script>
<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
<!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->
-->
</body>
</html>