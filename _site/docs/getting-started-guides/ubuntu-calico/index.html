

<!Doctype html>
<html id="docs">


<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="shortcut icon" type="image/png" href="/images/favicon.png">
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Roboto+Mono' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/css/styles.css"/>
	<script src="/js/jquery-2.2.0.min.js"></script>
	<script src="/js/script.js"></script>
	<title>Kubernetes - Ubuntu Nodes with Calico</title>
</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs/" class="button" id="viewDocs">View Documentation</a>
		<a href="/docs/hellonode/" class="button" id="tryKubernetes">Try Kubernetes</a>
		<button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="/docs/hellonode/">Get Started</a></h3>
				<p>Built for a multi-cloud world, public, private or hybrid. Seamlessly roll out new features.</p>
			</div>
			<div class="nav-box">
				<h3><a href="/docs/">Documentation</a></h3>
				<p>Pellentesque in ipsum id orci porta dapibus. Nulla porttitor accumsan tincidunt. </p>
			</div>
			<div class="nav-box">
				<h3><a href="/community/">Community</a></h3>
				<p>Vestibulum ac diam sit amet quam vehicula elementum sed sit amet dui. </p>
			</div>
			<div class="nav-box">
				<h3><a href="http://blog.kubernetes.io">Blog</a></h3>
				<p>Curabitur arcu erat, accumsan id imperdiet et, porttitor at sem. Quisque velit nisi, pretium ut lacinia in. </p>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="left">
				<h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
				<a href="" class="button">View On Github</a>
			</div>

			<div class="right">
				<h5 class="github-invite">Explore the community</h5>
				<div class="social">
					<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
					<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
					<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
					<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
					<a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
	<h1>Guides</h1>
	<h5>How to get started, and acheive tasks, using Kubernetes</h5>
	<div id="vendorStrip" class="light-text">
		<ul>
			<li><a href="/docs/">GUIDES</a></li>
			<li><a href="/docs/reference">REFERENCE</a></li>
			<li><a href="/docs/samples">SAMPLES</a></li>
			<li><a href="/docs/troubleshooting/">SUPPORT</a></li>
		</ul><!--
		<div class="dropdown">
			<div class="readout"></div>
			<a href="/v1.1/">Version 1.1</a>
            <a href="/v1.2/">Version 1.2</a>
		</div>-->
		<input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)">
	</div>
</section>

<section id="encyclopedia">
	<div id="docsToc">
        <div class="pi-accordion">
        
    <a class="item" data-title="Guides" href="/docs/"></a>
<div class="item" data-title="Getting Started">
  <div class="container">
    <a class="item" data-title="What is Kubernetes?" href="/docs/whatisk8s/"></a>
    <a class="item" data-title="Downloading Kubernetes" href="/docs/getting-started-guides/binary_release/"></a>
    <a class="item" data-title="Hello World Walkthrough" href="/docs/hellonode/"></a>
    <a class="item" data-title="Kubernetes 101" href="/docs/user-guide/walkthrough/"></a>
    <a class="item" data-title="Kubernetes 201" href="/docs/user-guide/walkthrough/k8s201/"></a>
  </div>
</div>
    <a class="item" data-title="User Guide" href="/docs/user-guide/"></a>
    <a class="item" data-title="Admin Guide" href="/docs/admin/"></a>
<div class="item" data-title="Running Kubernetes">
  <div class="container">
    <a class="item" data-title="Picking the Right Solution" href="/docs/getting-started-guides/"></a>
<div class="item" data-title="Running Kubernetes on Your Local Machine">
  <div class="container">
    <a class="item" data-title="Running Kubernetes Locally via Docker" href="/docs/getting-started-guides/docker/"></a>
    <a class="item" data-title="Running Kubernetes Locally via Vagrant" href="/docs/getting-started-guides/vagrant/"></a>
    <a class="item" data-title="Running Kubernetes Locally with No VM" href="/docs/getting-started-guides/locally/"></a>
  </div>
</div>
<div class="item" data-title="Running Kubernetes on Turn-key Cloud Solutions">
  <div class="container">
    <a class="item" data-title="Running Kubernetes on Google Container Engine" href="https://cloud.google.com/container-engine/docs/before-you-begin/" target='_blank'></a>
    <a class="item" data-title="Running Kubernetes on Google Compute Engine" href="/docs/getting-started-guides/gce/"></a>
    <a class="item" data-title="Running Kubernetes on AWS EC2" href="/docs/getting-started-guides/aws/"></a>
    <a class="item" data-title="Running Kubernetes on Azure" href="/docs/getting-started-guides/coreos/azure/"></a>
  </div>
</div>
<div class="item" data-title="Running Kubernetes on Custom Solutions">
  <div class="container">
    <a class="item" data-title="Getting Started From Scratch" href="/docs/getting-started-guides/scratch/"></a>
<div class="item" data-title="Custom Cloud Solutions">
  <div class="container">
    <a class="item" data-title="AWS or GCE on CoreOS" href="/docs/getting-started-guides/coreos/"></a>
    <a class="item" data-title="AWS or Joyent on Ubuntu" href="/docs/getting-started-guides/juju/"></a>
    <a class="item" data-title="Rackspace on CoreOS" href="/docs/getting-started-guides/rackspace/"></a>
  </div>
</div>
<div class="item" data-title="On-Premise VMs">
  <div class="container">
    <a class="item" data-title="Vagrant or VMware" href="/docs/getting-started-guides/coreos/"></a>
    <a class="item" data-title="Cloudstack" href="/docs/getting-started-guides/cloudstack/"></a>
    <a class="item" data-title="VMWare" href="/docs/getting-started-guides/vsphere/"></a>
    <a class="item" data-title="Juju" href="/docs/getting-started-guides/juju/"></a>
    <a class="item" data-title="DCOS" href="/docs/getting-started-guides/dcos/"></a>
    <a class="item" data-title="libvirt on CoreOS" href="/docs/getting-started-guides/libvirt-coreos/"></a>
    <a class="item" data-title="oVirt" href="/docs/getting-started-guides/ovirt/"></a>
    <a class="item" data-title="libvirt or KVM" href="/docs/getting-started-guides/fedora/flannel_multi_node_cluster/"></a>
    <a class="item" data-title="Multinode Cluster on CoreOS" href="/docs/getting-started-guides/coreos/coreos_multinode_cluster/"></a>
    <a class="item" data-title="Fedora With Calico Networking" href="/docs/getting-started-guides/fedora/fedora-calico/"></a>
    <a class="item" data-title="rkt" href="/docs/getting-started-guides/rkt/"></a>
    <a class="item" data-title="Kubernetes on Mesos" href="/docs/getting-started-guides/mesos/"></a>
    <a class="item" data-title="Kubernetes on Mesos on Docker" href="/docs/getting-started-guides/mesos-docker/"></a>
  </div>
</div>
<div class="item" data-title="Bare Metal">
  <div class="container">
    <a class="item" data-title="Offline" href="/docs/getting-started-guides/coreos/bare_metal_offline/"></a>
    <a class="item" data-title="Fedora via Ansible" href="/docs/getting-started-guides/fedora/fedora_ansible_config/"></a>
    <a class="item" data-title="Fedora (Single Node)" href="/docs/getting-started-guides/fedora/fedora_manual_config/"></a>
    <a class="item" data-title="Fedora (Multi Node)" href="/docs/getting-started-guides/fedora/flannel_multi_node_cluster/"></a>
    <a class="item" data-title="Centos" href="/docs/getting-started-guides/centos/centos_manual_config/"></a>
    <a class="item" data-title="Ubuntu" href="/docs/getting-started-guides/ubuntu/"></a>
    <a class="item" data-title="Docker (Multi-Node)" href="/docs/getting-started-guides/docker-multinode/"></a>
    <a class="item" data-title="CoreOS with Calico" href="/docs/getting-started-guides/coreos/bare_metal_calico/"></a>
    <a class="item" data-title="Ubuntu Nodes with Calico" href="/docs/getting-started-guides/ubuntu-calico/"></a>
  </div>
</div>
  </div>
</div>
  </div>
</div>
<div class="item" data-title="Administering Clusters">
  <div class="container">
    <a class="item" data-title="Cluster Management Guide" href="/docs/admin/cluster-management/"></a>
    <a class="item" data-title="Anatomy of a Cluster" href="/docs/admin/cluster-components/"></a>
    <a class="item" data-title="Using Multiple Clusters" href="/docs/admin/multi-cluster/"></a>
    <a class="item" data-title="Using Large Clusters" href="/docs/admin/cluster-large/"></a>
    <a class="item" data-title="Building High-Availability Clusters" href="/docs/admin/high-availability/"></a>
    <a class="item" data-title="Accessing Clusters" href="/docs/user-guide/accessing-the-cluster/"></a>
    <a class="item" data-title="Sharing a Cluster" href="/docs/admin/namespaces/"></a>
    <a class="item" data-title="Changing Cluster Size" href="https://github.com/kubernetes/kubernetes/wiki/User-FAQ#how-do-i-change-the-size-of-my-cluster/" target='_blank'></a>
    <a class="item" data-title="Creating a Custom Cluster from Scratch" href="/docs/getting-started-guides/scratch/"></a>
    <a class="item" data-title="Authenticating Across Clusters with kubeconfig" href="/docs/user-guide/kubeconfig-file/"></a>
  </div>
</div>
<div class="item" data-title="Using Nodes, Pods, and Containers">
  <div class="container">
    <a class="item" data-title="The Container Environment" href="/docs/user-guide/container-environment/"></a>
    <a class="item" data-title="Running Your First Containers" href="/docs/user-guide/simple-nginx/"></a>
    <a class="item" data-title="Working with Containers" href="/docs/user-guide/production-pods/"></a>
    <a class="item" data-title="Overriding Default Container Behavior" href="/docs/user-guide/containers/"></a>
    <a class="item" data-title="Running Commands in a Container with kubectl exec" href="/docs/user-guide/getting-into-containers/"></a>
    <a class="item" data-title="The Lifecycle of a Pod" href="/docs/user-guide/pod-states/"></a>
    <a class="item" data-title="Assigning Pods to Nodes" href="/docs/user-guide/node-selection/"></a>
    <a class="item" data-title="Creating Pods with the Downward API" href="/docs/user-guide/downward-api/"></a>
    <a class="item" data-title="Updating Live Pods" href="/docs/user-guide/update-demo/"></a>
    <a class="item" data-title="Installing a Kubernetes Master Node via Docker" href="/docs/getting-started-guides/docker-multinode/master/"></a>
    <a class="item" data-title="Adding a Kubernetes Worker Node via Docker" href="/docs/getting-started-guides/docker-multinode/worker/"></a>
  </div>
</div>
<div class="item" data-title="Networking">
  <div class="container">
    <a class="item" data-title="Networking in Kubernetes" href="/docs/admin/networking/"></a>
    <a class="item" data-title="Using DNS Pods and Services" href="/docs/admin/dns/"></a>
    <a class="item" data-title="Setting Up and Configuring DNS" href="https://github.com/kubernetes/kubernetes/tree/release-1.1/examples/cluster-dns" target='_blank'></a>
    <a class="item" data-title="Deploying DNS" href="/docs/getting-started-guides/docker-multinode/deployDNS/"></a>
    <a class="item" data-title="Connecting Applications" href="/docs/user-guide/connecting-applications/"></a>
    <a class="item" data-title="Creating Servers with External IPs" href="https://github.com/kubernetes/kubernetes/blob/release-1.1/examples/simple-nginx.md" target='_blank'></a>
    <a class="item" data-title="Connect with Proxies" href="/docs/user-guide/connecting-to-applications-proxy/"></a>
    <a class="item" data-title="Connect with Port Forwarding" href="/docs/user-guide/connecting-to-applications-port-forward/"></a>
    <a class="item" data-title="Configuring Your Cloud Provider's Firewalls" href="/docs/user-guide/services-firewalls/"></a>
  </div>
</div>
<div class="item" data-title="Configuring Kubernetes">
  <div class="container">
    <a class="item" data-title="Using Configuration Files" href="/docs/user-guide/simple-yaml/"></a>
    <a class="item" data-title="Best Practices for Configuration" href="/docs/user-guide/config-best-practices/"></a>
    <a class="item" data-title="Configuring Containers" href="/docs/user-guide/configuring-containers/"></a>
    <a class="item" data-title="Sharing Cluster Access with kubeconfig" href="/docs/user-guide/sharing-clusters/"></a>
    <a class="item" data-title="Using Environment Variables" href="/docs/user-guide/environment-guide/"></a>
    <a class="item" data-title="Managing Compute Resources" href="/docs/user-guide/compute-resources/"></a>
    <a class="item" data-title="Using kubectl to Manage Resources" href="/docs/user-guide/working-with-resources/"></a>
    <a class="item" data-title="Applying Resource Quotas and Limits" href="/docs/admin/resourcequota/"></a>
    <a class="item" data-title="Setting Pod CPU and Memory Limits" href="/docs/admin/limitrange/"></a>
    <a class="item" data-title="Configuring Garbage Collection" href="/docs/admin/garbage-collection/"></a>
    <a class="item" data-title="Configuring Kubernetes with Salt" href="/docs/admin/salt/"></a>
    <a class="item" data-title="Configuring Kubernetes Use of etcd" href="/docs/admin/etcd/"></a>
  </div>
</div>
<div class="item" data-title="Application Management and Deployment">
  <div class="container">
    <a class="item" data-title="Managing Applications: Prerequisites" href="/docs/user-guide/prereqs/"></a>
    <a class="item" data-title="Managing Deployments" href="/docs/user-guide/managing-deployments/"></a>
    <a class="item" data-title="Deploying Applications" href="/docs/user-guide/deploying-applications/"></a>
    <a class="item" data-title="Launching, Exposing, and Killing Applications" href="/docs/user-guide/quick-start/"></a>
  </div>
</div>
<div class="item" data-title="Testing and Monitoring">
  <div class="container">
    <a class="item" data-title="Testing a Kubernetes Cluster" href="/docs/getting-started-guides/docker-multinode/testing/"></a>
    <a class="item" data-title="Simulating Large Test Loads" href="https://github.com/kubernetes/kubernetes/tree/release-1.1/examples/k8petstore" target='_blank'></a>
    <a class="item" data-title="Checking Pod Health" href="/docs/user-guide/liveness/"></a>
    <a class="item" data-title="Using Explorer to Examine the Runtime Environment" href="https://github.com/kubernetes/kubernetes/tree/release-1.1/examples/explorer" target='_blank'></a>
    <a class="item" data-title="Resource Usage Monitoring" href="/docs/user-guide/monitoring/"></a>
    <a class="item" data-title="Logging" href="/docs/getting-started-guides/logging/"></a>
    <a class="item" data-title="Logging with Elasticsearch and Kibana" href="/docs/getting-started-guides/logging-elasticsearch/"></a>
  </div>
</div>
        </div> <!-- /pi-accordion -->
	</div> <!-- /docsToc -->
	<div id="docsContent">
        <p><a href="/docs/editdocs#docs/getting-started-guides/ubuntu-calico.md" id="editPageButton">Edit This Page</a></p>
    	<h1>Ubuntu Nodes with Calico</h1>
		<p>This document describes how to deploy Kubernetes on Ubuntu bare metal nodes with Calico Networking plugin. See <a href="http://projectcalico.org">projectcalico.org</a> for more information on what Calico is, and <a href="https://github.com/projectcalico/calico-docker">the calicoctl github</a> for more information on the command-line tool, <code class="highlighter-rouge">calicoctl</code>.</p>

<p>This guide will set up a simple Kubernetes cluster with a master and two nodes. We will start the following processes with systemd:</p>

<p>On the Master:</p>

<ul>
  <li><code class="highlighter-rouge">etcd</code></li>
  <li><code class="highlighter-rouge">kube-apiserver</code></li>
  <li><code class="highlighter-rouge">kube-controller-manager</code></li>
  <li><code class="highlighter-rouge">kube-scheduler</code></li>
  <li><code class="highlighter-rouge">calico-node</code></li>
</ul>

<p>On each Node:</p>

<ul>
  <li><code class="highlighter-rouge">kube-proxy</code></li>
  <li><code class="highlighter-rouge">kube-kubelet</code></li>
  <li><code class="highlighter-rouge">calico-node</code></li>
</ul>

<h2 id="prerequisites">Prerequisites</h2>

<ol>
  <li>This guide uses <code class="highlighter-rouge">systemd</code> and thus uses Ubuntu 15.04 which supports systemd natively.</li>
  <li>All machines should have the latest docker stable version installed. At the time of writing, that is Docker 1.7.0.
    <ul>
      <li>To install docker, follow <a href="https://docs.docker.com/installation/ubuntulinux/">these instructions</a></li>
    </ul>
  </li>
  <li>All hosts should be able to communicate with each other, as well as the internet, to download the necessary files.</li>
  <li>This demo assumes that none of the hosts have been configured with any Kubernetes or Calico software yet.</li>
</ol>

<h2 id="setup-master">Setup Master</h2>

<p>First, get the sample configurations for this tutorial</p>

<div class="highlighter-rouge"><pre class="highlight"><code>wget https://github.com/Metaswitch/calico-kubernetes-ubuntu-demo/archive/master.tar.gz
tar -xvf master.tar.gz
</code></pre>
</div>

<h3 id="setup-environment-variables-for-systemd-services-on-master">Setup environment variables for systemd services on Master</h3>

<p>Many of the sample systemd services provided rely on environment variables on a per-node basis. Here we’ll edit those environment variables and move them into place.</p>

<p>1.) Copy the network-environment-template from the <code class="highlighter-rouge">master</code> directory for editing.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cp calico-kubernetes-ubuntu-demo-master/master/network-environment-template network-environment
</code></pre>
</div>

<p>2.) Edit <code class="highlighter-rouge">network-environment</code> to represent your current host’s settings.</p>

<p>3.) Move the <code class="highlighter-rouge">network-environment</code> into <code class="highlighter-rouge">/etc</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo mv -f network-environment /etc
</code></pre>
</div>

<h3 id="install-kubernetes-on-master">Install Kubernetes on Master</h3>

<p>1.) Build &amp; Install Kubernetes binaries</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Get the Kubernetes Source</span>
wget https://github.com/kubernetes/kubernetes/releases/download/v1.0.3/kubernetes.tar.gz

<span class="c"># Untar it</span>
tar -xf kubernetes.tar.gz
tar -xf kubernetes/server/kubernetes-server-linux-amd64.tar.gz
kubernetes/cluster/ubuntu/build.sh

<span class="c"># Add binaries to /usr/bin</span>
sudo cp -f binaries/master/<span class="k">*</span> /usr/bin
sudo cp -f binaries/kubectl /usr/bin
</code></pre>
</div>

<p>2.) Install the sample systemd processes settings for launching kubernetes services</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo cp -f calico-kubernetes-ubuntu-demo-master/master/<span class="k">*</span>.service /etc/systemd
sudo systemctl <span class="nb">enable</span> /etc/systemd/etcd.service
sudo systemctl <span class="nb">enable</span> /etc/systemd/kube-apiserver.service
sudo systemctl <span class="nb">enable</span> /etc/systemd/kube-controller-manager.service
sudo systemctl <span class="nb">enable</span> /etc/systemd/kube-scheduler.service
</code></pre>
</div>

<p>3.) Launch the processes.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo systemctl start etcd.service
sudo systemctl start kube-apiserver.service
sudo systemctl start kube-controller-manager.service
sudo systemctl start kube-scheduler.service
</code></pre>
</div>

<h3 id="install-calico-on-master">Install Calico on Master</h3>

<p>In order to allow the master to route to pods on our nodes, we will launch the calico-node daemon on our master. This will allow it to learn routes over BGP from the other calico-node daemons in the cluster. The docker daemon should already be running before calico is started.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Install the calicoctl binary, which will be used to launch calico</span>
wget https://github.com/projectcalico/calico-docker/releases/download/v0.5.5/calicoctl
chmod +x calicoctl
sudo cp -f calicoctl /usr/bin

<span class="c"># Install and start the calico service</span>
sudo cp -f calico-kubernetes-ubuntu-demo-master/master/calico-node.service /etc/systemd
sudo systemctl <span class="nb">enable</span> /etc/systemd/calico-node.service
sudo systemctl start calico-node.service
</code></pre>
</div>

<blockquote>
  <p>Note: calico-node may take a few minutes on first boot while it downloads the calico-node docker image.</p>
</blockquote>

<h2 id="setup-nodes">Setup Nodes</h2>

<p>Perform these steps <strong>once on each node</strong>, ensuring you appropriately set the environment variables on each node</p>

<h3 id="setup-environment-variables-for-systemd-services-on-the-node">Setup environment variables for systemd services on the Node</h3>

<p>1.) Get the sample configurations for this tutorial</p>

<div class="highlighter-rouge"><pre class="highlight"><code>wget https://github.com/Metaswitch/calico-kubernetes-ubuntu-demo/archive/master.tar.gz
tar -xvf master.tar.gz
</code></pre>
</div>

<p>2.) Copy the network-environment-template from the <code class="highlighter-rouge">node</code> directory</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cp calico-kubernetes-ubuntu-demo-master/node/network-environment-template network-environment
</code></pre>
</div>

<p>3.) Edit <code class="highlighter-rouge">network-environment</code> to represent your current host’s settings.</p>

<p>4.) Move <code class="highlighter-rouge">network-environment</code> into <code class="highlighter-rouge">/etc</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo mv -f network-environment /etc
</code></pre>
</div>

<h3 id="configure-docker-on-the-node">Configure Docker on the Node</h3>

<h4 id="create-the-veth">Create the veth</h4>

<p>Instead of using docker’s default interface (docker0), we will configure a new one to use desired IP ranges</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo apt-get install -y bridge-utils
sudo brctl addbr cbr0
sudo ifconfig cbr0 up
sudo ifconfig cbr0 &lt;IP&gt;/24
</code></pre>
</div>

<blockquote>
  <p>Replace &lt;IP&gt;  with the subnet for this host’s containers. Example topology:</p>
</blockquote>

<table>
  <thead>
    <tr>
      <th>Node</th>
      <th>cbr0 IP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>node-1</td>
      <td>192.168.1.1/24</td>
    </tr>
    <tr>
      <td>node-2</td>
      <td>192.168.2.1/24</td>
    </tr>
    <tr>
      <td>node-X</td>
      <td>192.168.X.1/24</td>
    </tr>
  </tbody>
</table>

<h4 id="start-docker-on-cbr0">Start docker on cbr0</h4>

<p>The Docker daemon must be started and told to use the already configured cbr0 instead of using the usual docker0, as well as disabling ip-masquerading and modification of the ip-tables.</p>

<p>1.) Edit the ubuntu-15.04 docker.service for systemd at: <code class="highlighter-rouge">/lib/systemd/system/docker.service</code></p>

<p>2.) Find the line that reads <code class="highlighter-rouge">ExecStart=/usr/bin/docker -d -H fd://</code> and append the following flags: <code class="highlighter-rouge">--bridge=cbr0 --iptables=false --ip-masq=false</code></p>

<p>3.) Reload systemctl and restart docker.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo systemctl daemon-reload
sudo systemctl restart docker
</code></pre>
</div>

<h3 id="install-calico-on-the-node">Install Calico on the Node</h3>

<p>1.) Install Calico</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Get the calicoctl binary</span>
wget https://github.com/projectcalico/calico-docker/releases/download/v0.5.5/calicoctl
chmod +x calicoctl
sudo cp -f calicoctl /usr/bin

<span class="c"># Start calico on this node</span>
sudo cp calico-kubernetes-ubuntu-demo-master/node/calico-node.service /etc/systemd
sudo systemctl <span class="nb">enable</span> /etc/systemd/calico-node.service
sudo systemctl start calico-node.service
</code></pre>
</div>

<blockquote>
  <p>The calico-node service will automatically get the kubernetes-calico plugin binary and install it on the host system.</p>
</blockquote>

<p>2.) Use calicoctl to add an IP pool. We must specify the IP and port that the master’s etcd is listening on.
<strong>NOTE: This step only needs to be performed once per Kubernetes deployment, as it covers all the node’s IP ranges.</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">ETCD_AUTHORITY</span><span class="o">=</span>&lt;MASTER_IP&gt;:4001 calicoctl pool add 192.168.0.0/16
</code></pre>
</div>

<h3 id="install-kubernetes-on-the-node">Install Kubernetes on the Node</h3>

<p>1.) Build &amp; Install Kubernetes binaries</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Get the Kubernetes Source</span>
wget https://github.com/kubernetes/kubernetes/releases/download/v1.0.3/kubernetes.tar.gz

<span class="c"># Untar it</span>
tar -xf kubernetes.tar.gz
tar -xf kubernetes/server/kubernetes-server-linux-amd64.tar.gz
kubernetes/cluster/ubuntu/build.sh

<span class="c"># Add binaries to /usr/bin</span>
sudo cp -f binaries/minion/<span class="k">*</span> /usr/bin

<span class="c"># Get the iptables based kube-proxy reccomended for this demo</span>
wget https://github.com/projectcalico/calico-kubernetes/releases/download/v0.1.1/kube-proxy
sudo cp kube-proxy /usr/bin/
sudo chmod +x /usr/bin/kube-proxy
</code></pre>
</div>

<p>2.) Install and launch the sample systemd processes settings for launching Kubernetes services</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo cp calico-kubernetes-ubuntu-demo-master/node/kube-proxy.service /etc/systemd/
sudo cp calico-kubernetes-ubuntu-demo-master/node/kube-kubelet.service /etc/systemd/
sudo systemctl <span class="nb">enable</span> /etc/systemd/kube-proxy.service
sudo systemctl <span class="nb">enable</span> /etc/systemd/kube-kubelet.service
sudo systemctl start kube-proxy.service
sudo systemctl start kube-kubelet.service
</code></pre>
</div>

<blockquote>
  <p><em>You may want to consider checking their status after to ensure everything is running</em></p>
</blockquote>

<h2 id="install-the-dns-addon">Install the DNS Addon</h2>

<p>Most Kubernetes deployments will require the DNS addon for service discovery.  For more on DNS service discovery, check <a href="https://releases.k8s.io/release-1.1/cluster/addons/dns">here</a>.</p>

<p>The config repository for this guide comes with manifest files to start the DNS addon.  To install DNS, do the following on your Master node.</p>

<p>Replace <code class="highlighter-rouge">&lt;MASTER_IP&gt;</code> in <code class="highlighter-rouge">calico-kubernetes-ubuntu-demo-master/dns/skydns-rc.yaml</code> with your Master’s IP address.  Then, create <code class="highlighter-rouge">skydns-rc.yaml</code> and <code class="highlighter-rouge">skydns-svc.yaml</code> using <code class="highlighter-rouge">kubectl create -f &lt;FILE&gt;</code>.</p>

<h2 id="launch-other-services-with-calico-kubernetes">Launch other Services With Calico-Kubernetes</h2>

<p>At this point, you have a fully functioning cluster running on kubernetes with a master and 2 nodes networked with Calico. You can now follow any of the <a href="https://github.com/kubernetes/kubernetes/tree/release-1.1/examples/">standard documentation</a> to set up other services on your cluster.</p>

<h2 id="connectivity-to-outside-the-cluster">Connectivity to outside the cluster</h2>

<p>With this sample configuration, because the containers have private <code class="highlighter-rouge">192.168.0.0/16</code> IPs, you will need NAT to allow   connectivity between containers and the internet. However, in a full datacenter deployment, NAT is not always necessary, since Calico can peer with the border routers over BGP.</p>

<h3 id="nat-on-the-nodes">NAT on the nodes</h3>

<p>The simplest method for enabling connectivity from containers to the internet is to use an iptables masquerade rule. This is the standard mechanism <a href="/docs/admin/networking/#google-compute-engine-gce">recommended</a> in the Kubernetes GCE environment.</p>

<p>We need to NAT traffic that has a destination outside of the cluster. Internal traffic includes the master/nodes, and the container IP pools. A suitable masquerade chain would follow the pattern below, replacing the following variables:</p>

<ul>
  <li><code class="highlighter-rouge">CONTAINER_SUBNET</code>: The cluster-wide subnet from which container IPs are chosen.  All cbr0 bridge subnets fall within this range. The above example uses <code class="highlighter-rouge">192.168.0.0/16</code>.</li>
  <li><code class="highlighter-rouge">KUBERNETES_HOST_SUBNET</code>: The subnet from which Kubernetes node / master IP addresses have been chosen.</li>
  <li><code class="highlighter-rouge">HOST_INTERFACE</code>: The interface on the Kubernetes node which is used for external connectivity.  The above example uses <code class="highlighter-rouge">eth0</code></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo iptables -t nat -N KUBE-OUTBOUND-NAT
sudo iptables -t nat -A KUBE-OUTBOUND-NAT -d &lt;CONTAINER_SUBNET&gt; -o &lt;HOST_INTERFACE&gt; -j RETURN
sudo iptables -t nat -A KUBE-OUTBOUND-NAT -d &lt;KUBERNETES_HOST_SUBNET&gt; -o &lt;HOST_INTERFACE&gt; -j RETURN
sudo iptables -t nat -A KUBE-OUTBOUND-NAT -j MASQUERADE
sudo iptables -t nat -A POSTROUTING -j KUBE-OUTBOUND-NAT
</code></pre>
</div>

<p>This chain should be applied on the master and all nodes. In production, these rules should be persisted, e.g. with <code class="highlighter-rouge">iptables-persistent</code>.</p>

<h3 id="nat-at-the-border-router">NAT at the border router</h3>

<p>In a datacenter environment, it is recommended to configure Calico to peer with the border routers over BGP. This means that the container IPs will be routable anywhere in the datacenter, and so NAT is not needed on the nodes (though it may be enabled at the datacenter edge to allow outbound-only internet connectivity).</p>

        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/getting-started-guides/ubuntu-calico.md?pixel" alt="Analytics" /></a>
        <div id="pd_rating_holder_8345992"></div>
		<script type="text/javascript">
        PDRTJS_settings_8345992 = {
        "id" : "8345992",
        "unique_id" : "/docs/getting-started-guides/ubuntu-calico/",
        "title" : "Ubuntu Nodes with Calico",
        "permalink" : "http://kubernetes.github.io/docs/getting-started-guides/ubuntu-calico/"
        };
        (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
        </script>
	</div>
</section>

<footer>
	<main class="light-text">
		<nav>
			<a href="/docs/hellonode/">Get Started</a>
			<a href="/docs/">Documentation</a>
			<a href="http://blog.kubernetes.io/">Blog</a>
			<a href="/community/">Community</a>
		</nav>
		<div class="social">
			<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
			<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
			<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
			<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
			<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
			<a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
			<label for="wishField">I wish this page <input type="text" id="wishField" name="wishField" placeholder="enter your wish"></label>
		</div>
		<div class="center">&copy; 2016 Kubernetes</div>
	</main>
</footer>



<style>
	.cse .gsc-control-cse, .gsc-control-cse {
		padding: 0;
	}

	.gsc-above-wrapper-area {
		border-bottom: 0;
	}
</style>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-36037335-10', 'auto');
  ga('send', 'pageview');
</script>
<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
<!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->
-->
</body>
</html>