

<!Doctype html>
<html id="docs">


<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="shortcut icon" type="image/png" href="/images/favicon.png">
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Roboto+Mono' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/css/styles.css"/>
	<script src="/js/jquery-2.2.0.min.js"></script>
	<script src="/js/script.js"></script>
	<title>Kubernetes - Cluster Management Guide</title>
</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs/" class="button" id="viewDocs">View Documentation</a>
		<a href="/docs/hellonode/" class="button" id="tryKubernetes">Try Kubernetes</a>
		<button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="/docs/hellonode/">Get Started</a></h3>
				<p>Built for a multi-cloud world, public, private or hybrid. Seamlessly roll out new features.</p>
			</div>
			<div class="nav-box">
				<h3><a href="/docs/">Documentation</a></h3>
				<p>Pellentesque in ipsum id orci porta dapibus. Nulla porttitor accumsan tincidunt. </p>
			</div>
			<div class="nav-box">
				<h3><a href="/community/">Community</a></h3>
				<p>Vestibulum ac diam sit amet quam vehicula elementum sed sit amet dui. </p>
			</div>
			<div class="nav-box">
				<h3><a href="http://blog.kubernetes.io">Blog</a></h3>
				<p>Curabitur arcu erat, accumsan id imperdiet et, porttitor at sem. Quisque velit nisi, pretium ut lacinia in. </p>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="left">
				<h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
				<a href="" class="button">View On Github</a>
			</div>

			<div class="right">
				<h5 class="github-invite">Explore the community</h5>
				<div class="social">
					<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
					<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
					<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
					<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
					<a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
	<h1>Guides</h1>
	<h5>How to get started, and acheive tasks, using Kubernetes</h5>
	<div id="vendorStrip" class="light-text">
		<ul>
			<li><a href="/docs/">GUIDES</a></li>
			<li><a href="/docs/reference">REFERENCE</a></li>
			<li><a href="/docs/samples">SAMPLES</a></li>
			<li><a href="/docs/troubleshooting/">SUPPORT</a></li>
		</ul><!--
		<div class="dropdown">
			<div class="readout"></div>
			<a href="/v1.1/">Version 1.1</a>
            <a href="/v1.2/">Version 1.2</a>
		</div>-->
		<input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)">
	</div>
</section>

<section id="encyclopedia">
	<div id="docsToc">
        <div class="pi-accordion">
        
    <a class="item" data-title="Guides" href="/docs/"></a>
<div class="item" data-title="Getting Started">
  <div class="container">
    <a class="item" data-title="What is Kubernetes?" href="/docs/whatisk8s/"></a>
    <a class="item" data-title="Downloading Kubernetes" href="/docs/getting-started-guides/binary_release/"></a>
    <a class="item" data-title="Hello World Walkthrough" href="/docs/hellonode/"></a>
    <a class="item" data-title="Kubernetes 101" href="/docs/user-guide/walkthrough/"></a>
    <a class="item" data-title="Kubernetes 201" href="/docs/user-guide/walkthrough/k8s201/"></a>
  </div>
</div>
    <a class="item" data-title="User Guide" href="/docs/user-guide/"></a>
    <a class="item" data-title="Admin Guide" href="/docs/admin/"></a>
<div class="item" data-title="Running Kubernetes">
  <div class="container">
    <a class="item" data-title="Picking the Right Solution" href="/docs/getting-started-guides/"></a>
<div class="item" data-title="Running Kubernetes on Your Local Machine">
  <div class="container">
    <a class="item" data-title="Running Kubernetes Locally via Docker" href="/docs/getting-started-guides/docker/"></a>
    <a class="item" data-title="Running Kubernetes Locally via Vagrant" href="/docs/getting-started-guides/vagrant/"></a>
    <a class="item" data-title="Running Kubernetes Locally with No VM" href="/docs/getting-started-guides/locally/"></a>
  </div>
</div>
<div class="item" data-title="Running Kubernetes on Turn-key Cloud Solutions">
  <div class="container">
    <a class="item" data-title="Running Kubernetes on Google Container Engine" href="https://cloud.google.com/container-engine/docs/before-you-begin/" target='_blank'></a>
    <a class="item" data-title="Running Kubernetes on Google Compute Engine" href="/docs/getting-started-guides/gce/"></a>
    <a class="item" data-title="Running Kubernetes on AWS EC2" href="/docs/getting-started-guides/aws/"></a>
    <a class="item" data-title="Running Kubernetes on Azure" href="/docs/getting-started-guides/coreos/azure/"></a>
  </div>
</div>
<div class="item" data-title="Running Kubernetes on Custom Solutions">
  <div class="container">
    <a class="item" data-title="Getting Started From Scratch" href="/docs/getting-started-guides/scratch/"></a>
<div class="item" data-title="Custom Cloud Solutions">
  <div class="container">
    <a class="item" data-title="AWS or GCE on CoreOS" href="/docs/getting-started-guides/coreos/"></a>
    <a class="item" data-title="AWS or Joyent on Ubuntu" href="/docs/getting-started-guides/juju/"></a>
    <a class="item" data-title="Rackspace on CoreOS" href="/docs/getting-started-guides/rackspace/"></a>
  </div>
</div>
<div class="item" data-title="On-Premise VMs">
  <div class="container">
    <a class="item" data-title="Vagrant or VMware" href="/docs/getting-started-guides/coreos/"></a>
    <a class="item" data-title="Cloudstack" href="/docs/getting-started-guides/cloudstack/"></a>
    <a class="item" data-title="VMWare" href="/docs/getting-started-guides/vsphere/"></a>
    <a class="item" data-title="Juju" href="/docs/getting-started-guides/juju/"></a>
    <a class="item" data-title="DCOS" href="/docs/getting-started-guides/dcos/"></a>
    <a class="item" data-title="libvirt on CoreOS" href="/docs/getting-started-guides/libvirt-coreos/"></a>
    <a class="item" data-title="oVirt" href="/docs/getting-started-guides/ovirt/"></a>
    <a class="item" data-title="libvirt or KVM" href="/docs/getting-started-guides/fedora/flannel_multi_node_cluster/"></a>
    <a class="item" data-title="Multinode Cluster on CoreOS" href="/docs/getting-started-guides/coreos/coreos_multinode_cluster/"></a>
    <a class="item" data-title="Fedora With Calico Networking" href="/docs/getting-started-guides/fedora/fedora-calico/"></a>
    <a class="item" data-title="rkt" href="/docs/getting-started-guides/rkt/"></a>
    <a class="item" data-title="Kubernetes on Mesos" href="/docs/getting-started-guides/mesos/"></a>
    <a class="item" data-title="Kubernetes on Mesos on Docker" href="/docs/getting-started-guides/mesos-docker/"></a>
  </div>
</div>
<div class="item" data-title="Bare Metal">
  <div class="container">
    <a class="item" data-title="Offline" href="/docs/getting-started-guides/coreos/bare_metal_offline/"></a>
    <a class="item" data-title="Fedora via Ansible" href="/docs/getting-started-guides/fedora/fedora_ansible_config/"></a>
    <a class="item" data-title="Fedora (Single Node)" href="/docs/getting-started-guides/fedora/fedora_manual_config/"></a>
    <a class="item" data-title="Fedora (Multi Node)" href="/docs/getting-started-guides/fedora/flannel_multi_node_cluster/"></a>
    <a class="item" data-title="Centos" href="/docs/getting-started-guides/centos/centos_manual_config/"></a>
    <a class="item" data-title="Ubuntu" href="/docs/getting-started-guides/ubuntu/"></a>
    <a class="item" data-title="Docker (Multi-Node)" href="/docs/getting-started-guides/docker-multinode/"></a>
    <a class="item" data-title="CoreOS with Calico" href="/docs/getting-started-guides/coreos/bare_metal_calico/"></a>
    <a class="item" data-title="Ubuntu Nodes with Calico" href="/docs/getting-started-guides/ubuntu-calico/"></a>
  </div>
</div>
  </div>
</div>
  </div>
</div>
<div class="item" data-title="Administering Clusters">
  <div class="container">
    <a class="item" data-title="Cluster Management Guide" href="/docs/admin/cluster-management/"></a>
    <a class="item" data-title="Anatomy of a Cluster" href="/docs/admin/cluster-components/"></a>
    <a class="item" data-title="Using Multiple Clusters" href="/docs/admin/multi-cluster/"></a>
    <a class="item" data-title="Using Large Clusters" href="/docs/admin/cluster-large/"></a>
    <a class="item" data-title="Building High-Availability Clusters" href="/docs/admin/high-availability/"></a>
    <a class="item" data-title="Accessing Clusters" href="/docs/user-guide/accessing-the-cluster/"></a>
    <a class="item" data-title="Sharing a Cluster" href="/docs/admin/namespaces/"></a>
    <a class="item" data-title="Changing Cluster Size" href="https://github.com/kubernetes/kubernetes/wiki/User-FAQ#how-do-i-change-the-size-of-my-cluster/" target='_blank'></a>
    <a class="item" data-title="Creating a Custom Cluster from Scratch" href="/docs/getting-started-guides/scratch/"></a>
    <a class="item" data-title="Authenticating Across Clusters with kubeconfig" href="/docs/user-guide/kubeconfig-file/"></a>
  </div>
</div>
<div class="item" data-title="Using Nodes, Pods, and Containers">
  <div class="container">
    <a class="item" data-title="The Container Environment" href="/docs/user-guide/container-environment/"></a>
    <a class="item" data-title="Running Your First Containers" href="/docs/user-guide/simple-nginx/"></a>
    <a class="item" data-title="Working with Containers" href="/docs/user-guide/production-pods/"></a>
    <a class="item" data-title="Overriding Default Container Behavior" href="/docs/user-guide/containers/"></a>
    <a class="item" data-title="Running Commands in a Container with kubectl exec" href="/docs/user-guide/getting-into-containers/"></a>
    <a class="item" data-title="The Lifecycle of a Pod" href="/docs/user-guide/pod-states/"></a>
    <a class="item" data-title="Assigning Pods to Nodes" href="/docs/user-guide/node-selection/"></a>
    <a class="item" data-title="Creating Pods with the Downward API" href="/docs/user-guide/downward-api/"></a>
    <a class="item" data-title="Updating Live Pods" href="/docs/user-guide/update-demo/"></a>
    <a class="item" data-title="Installing a Kubernetes Master Node via Docker" href="/docs/getting-started-guides/docker-multinode/master/"></a>
    <a class="item" data-title="Adding a Kubernetes Worker Node via Docker" href="/docs/getting-started-guides/docker-multinode/worker/"></a>
  </div>
</div>
<div class="item" data-title="Networking">
  <div class="container">
    <a class="item" data-title="Networking in Kubernetes" href="/docs/admin/networking/"></a>
    <a class="item" data-title="Using DNS Pods and Services" href="/docs/admin/dns/"></a>
    <a class="item" data-title="Setting Up and Configuring DNS" href="https://github.com/kubernetes/kubernetes/tree/release-1.1/examples/cluster-dns" target='_blank'></a>
    <a class="item" data-title="Deploying DNS" href="/docs/getting-started-guides/docker-multinode/deployDNS/"></a>
    <a class="item" data-title="Connecting Applications" href="/docs/user-guide/connecting-applications/"></a>
    <a class="item" data-title="Creating Servers with External IPs" href="https://github.com/kubernetes/kubernetes/blob/release-1.1/examples/simple-nginx.md" target='_blank'></a>
    <a class="item" data-title="Connect with Proxies" href="/docs/user-guide/connecting-to-applications-proxy/"></a>
    <a class="item" data-title="Connect with Port Forwarding" href="/docs/user-guide/connecting-to-applications-port-forward/"></a>
    <a class="item" data-title="Configuring Your Cloud Provider's Firewalls" href="/docs/user-guide/services-firewalls/"></a>
  </div>
</div>
<div class="item" data-title="Configuring Kubernetes">
  <div class="container">
    <a class="item" data-title="Using Configuration Files" href="/docs/user-guide/simple-yaml/"></a>
    <a class="item" data-title="Best Practices for Configuration" href="/docs/user-guide/config-best-practices/"></a>
    <a class="item" data-title="Configuring Containers" href="/docs/user-guide/configuring-containers/"></a>
    <a class="item" data-title="Sharing Cluster Access with kubeconfig" href="/docs/user-guide/sharing-clusters/"></a>
    <a class="item" data-title="Using Environment Variables" href="/docs/user-guide/environment-guide/"></a>
    <a class="item" data-title="Managing Compute Resources" href="/docs/user-guide/compute-resources/"></a>
    <a class="item" data-title="Using kubectl to Manage Resources" href="/docs/user-guide/working-with-resources/"></a>
    <a class="item" data-title="Applying Resource Quotas and Limits" href="/docs/admin/resourcequota/"></a>
    <a class="item" data-title="Setting Pod CPU and Memory Limits" href="/docs/admin/limitrange/"></a>
    <a class="item" data-title="Configuring Garbage Collection" href="/docs/admin/garbage-collection/"></a>
    <a class="item" data-title="Configuring Kubernetes with Salt" href="/docs/admin/salt/"></a>
    <a class="item" data-title="Configuring Kubernetes Use of etcd" href="/docs/admin/etcd/"></a>
  </div>
</div>
<div class="item" data-title="Application Management and Deployment">
  <div class="container">
    <a class="item" data-title="Managing Applications: Prerequisites" href="/docs/user-guide/prereqs/"></a>
    <a class="item" data-title="Managing Deployments" href="/docs/user-guide/managing-deployments/"></a>
    <a class="item" data-title="Deploying Applications" href="/docs/user-guide/deploying-applications/"></a>
    <a class="item" data-title="Launching, Exposing, and Killing Applications" href="/docs/user-guide/quick-start/"></a>
  </div>
</div>
<div class="item" data-title="Testing and Monitoring">
  <div class="container">
    <a class="item" data-title="Testing a Kubernetes Cluster" href="/docs/getting-started-guides/docker-multinode/testing/"></a>
    <a class="item" data-title="Simulating Large Test Loads" href="https://github.com/kubernetes/kubernetes/tree/release-1.1/examples/k8petstore" target='_blank'></a>
    <a class="item" data-title="Checking Pod Health" href="/docs/user-guide/liveness/"></a>
    <a class="item" data-title="Using Explorer to Examine the Runtime Environment" href="https://github.com/kubernetes/kubernetes/tree/release-1.1/examples/explorer" target='_blank'></a>
    <a class="item" data-title="Resource Usage Monitoring" href="/docs/user-guide/monitoring/"></a>
    <a class="item" data-title="Logging" href="/docs/getting-started-guides/logging/"></a>
    <a class="item" data-title="Logging with Elasticsearch and Kibana" href="/docs/getting-started-guides/logging-elasticsearch/"></a>
  </div>
</div>
        </div> <!-- /pi-accordion -->
	</div> <!-- /docsToc -->
	<div id="docsContent">
        <p><a href="/docs/editdocs#docs/admin/cluster-management.md" id="editPageButton">Edit This Page</a></p>
    	<h1>Cluster Management Guide</h1>
		<p>This document describes several topics related to the lifecycle of a cluster: creating a new cluster,
upgrading your cluster’s
master and worker nodes, performing node maintenance (e.g. kernel upgrades), and upgrading the Kubernetes API version of a
running cluster.</p>

<h2 id="creating-and-configuring-a-cluster">Creating and configuring a Cluster</h2>

<p>To install Kubernetes on a set of machines, consult one of the existing <a href="/docs/getting-started-guides/">Getting Started guides</a> depending on your environment.</p>

<h2 id="upgrading-a-cluster">Upgrading a cluster</h2>

<p>The current state of cluster upgrades is provider dependent.</p>

<h3 id="master-upgrades">Master Upgrades</h3>

<p>Both Google Container Engine (GKE) and
Compute Engine Open Source (GCE-OSS) support node upgrades via a <a href="https://cloud.google.com/compute/docs/instance-groups/">Managed Instance Group</a>.
Managed Instance Group upgrades sequentially delete and recreate each virtual machine, while maintaining the same
Persistent Disk (PD) to ensure that data is retained across the upgrade.</p>

<p>In contrast, the <code class="highlighter-rouge">kube-push.sh</code> process used on <a href="#other-platforms">other platforms</a> attempts to upgrade the binaries in
places, without recreating the virtual machines.</p>

<h3 id="node-upgrades">Node Upgrades</h3>

<p>Node upgrades for GKE and GCE-OSS again use a Managed Instance Group, each node is sequentially destroyed and then recreated with new software.  Any Pods that are running
on that node need to be controlled by a Replication Controller, or manually re-created after the roll out.</p>

<p>For other platforms, <code class="highlighter-rouge">kube-push.sh</code> is again used, performing an in-place binary upgrade on existing machines.</p>

<h3 id="upgrading-google-container-engine-gke">Upgrading Google Container Engine (GKE)</h3>

<p>Google Container Engine automatically updates master components (e.g. <code class="highlighter-rouge">kube-apiserver</code>, <code class="highlighter-rouge">kube-scheduler</code>) to the latest
version. It also handles upgrading the operating system and other components that the master runs on.</p>

<p>The node upgrade process is user-initiated and is described in the <a href="https://cloud.google.com/container-engine/docs/clusters/upgrade">GKE documentation.</a></p>

<h3 id="upgrading-open-source-google-compute-engine-clusters">Upgrading open source Google Compute Engine clusters</h3>

<p>Upgrades on open source Google Compute Engine (GCE) clusters are controlled by the <code class="highlighter-rouge">cluster/gce/upgrade.sh</code> script.</p>

<p>Get its usage by running <code class="highlighter-rouge">cluster/gce/upgrade.sh -h</code>.</p>

<p>For example, to upgrade just your master to a specific version (v1.0.2):</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cluster/gce/upgrade.sh -M v1.0.2
</code></pre>
</div>

<p>Alternatively, to upgrade your entire cluster to the latest stable release:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cluster/gce/upgrade.sh release/stable
</code></pre>
</div>

<h3 id="other-platforms">Other platforms</h3>

<p>The <code class="highlighter-rouge">cluster/kube-push.sh</code> script will do a rudimentary update.  This process is still quite experimental, we
recommend testing the upgrade on an experimental cluster before performing the update on a production cluster.</p>

<h2 id="resizing-a-cluster">Resizing a cluster</h2>

<p>If your cluster runs short on resources you can easily add more machines to it if your cluster is running in <a href="/docs/admin/node/#self-registration-of-nodes">Node self-registration mode</a>.
If you’re using GCE or GKE it’s done by resizing Instance Group managing your Nodes. It can be accomplished by modifying number of instances on <code class="highlighter-rouge">Compute &gt; Compute Engine &gt; Instance groups &gt; your group &gt; Edit group</code> <a href="https://console.developers.google.com">Google Cloud Console page</a> or using gcloud CLI:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>gcloud compute instance-groups managed --zone compute-zone resize my-cluster-minon-group --new-size 42
</code></pre>
</div>

<p>Instance Group will take care of putting appropriate image on new machines and start them, while Kubelet will register its Node with API server to make it available for scheduling. If you scale the instance group down, system will randomly choose Nodes to kill.</p>

<p>In other environments you may need to configure the machine yourself and tell the Kubelet on which machine API server is running.</p>

<h3 id="horizontal-auto-scaling-of-nodes-gce">Horizontal auto-scaling of nodes (GCE)</h3>

<p>If you are using GCE, you can configure your cluster so that the number of nodes will be automatically scaled based on their CPU and memory utilization.
Before setting up the cluster by <code class="highlighter-rouge">kube-up.sh</code>, you can set <code class="highlighter-rouge">KUBE_ENABLE_NODE_AUTOSCALE</code>
environment variable to <code class="highlighter-rouge">true</code>
and export it.
The script will create an autoscaler for the instance group managing your nodes.</p>

<p>The autoscaler will try to maintain the average CPU and memory utilization of nodes within the cluster close to the target value.
The target value can be configured by <code class="highlighter-rouge">KUBE_TARGET_NODE_UTILIZATION</code>
environment variable (default: 0.7) for <code class="highlighter-rouge">kube-up.sh</code> when creating the cluster.
The node utilization is the total node’s CPU/memory usage (OS + k8s + user load) divided by the node’s capacity.
If the desired numbers of nodes in the cluster resulting from CPU utilization and memory utilization are different,
the autoscaler will choose the bigger number.
The number of nodes in the cluster set by the autoscaler will be limited from <code class="highlighter-rouge">KUBE_AUTOSCALER_MIN_NODES</code>
(default: 1)
to <code class="highlighter-rouge">KUBE_AUTOSCALER_MAX_NODES</code>
(default: the initial number of nodes in the cluster).</p>

<p>The autoscaler is implemented as a Compute Engine Autoscaler.
The initial values of the autoscaler parameters set by <code class="highlighter-rouge">kube-up.sh</code> and some more advanced options can be tweaked on
<code class="highlighter-rouge">Compute &gt; Compute Engine &gt; Instance groups &gt; your group &gt; Edit group</code><a href="https://console.developers.google.com">Google Cloud Console page</a>
or using gcloud CLI:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>gcloud preview autoscaler --zone compute-zone &lt;<span class="nb">command</span>&gt;
</code></pre>
</div>

<p>Note that autoscaling will work properly only if node metrics are accessible in Google Cloud Monitoring. To make the metrics accessible, you need to create your cluster with <code class="highlighter-rouge">KUBE_ENABLE_CLUSTER_MONITORING</code> equal to <code class="highlighter-rouge">google</code> or <code class="highlighter-rouge">googleinfluxdb</code> (<code class="highlighter-rouge">googleinfluxdb</code> is the default value).</p>

<h2 id="maintenance-on-a-node">Maintenance on a Node</h2>

<p>If you need to reboot a node (such as for a kernel upgrade, libc upgrade, hardware repair, etc.), and the downtime is
brief, then when the Kubelet restarts, it will attempt to restart the pods scheduled to it.  If the reboot takes longer,
then the node controller will terminate the pods that are bound to the unavailable node.  If there is a corresponding
replication controller, then a new copy of the pod will be started on a different node.  So, in the case where all
pods are replicated, upgrades can be done without special coordination, assuming that not all nodes will go down at the same time.</p>

<p>If you want more control over the upgrading process, you may use the following workflow:</p>

<p>Mark the node to be rebooted as unschedulable:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>kubectl replace nodes <span class="nv">$NODENAME</span> --patch<span class="o">=</span><span class="s1">'{"apiVersion": "v1", "spec": {"unschedulable": true}}'</span>
</code></pre>
</div>

<p>This keeps new pods from landing on the node while you are trying to get them off.</p>

<p>Get the pods off the machine, via any of the following strategies:
   * Wait for finite-duration pods to complete.
   * Delete pods with:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>kubectl delete pods <span class="nv">$PODNAME</span>
</code></pre>
</div>

<p>For pods with a replication controller, the pod will eventually be replaced by a new pod which will be scheduled to a new node. Additionally, if the pod is part of a service, then clients will automatically be redirected to the new pod.</p>

<p>For pods with no replication controller, you need to bring up a new copy of the pod, and assuming it is not part of a service, redirect clients to it.</p>

<p>Perform maintenance work on the node.</p>

<p>Make the node schedulable again:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>kubectl replace nodes <span class="nv">$NODENAME</span> --patch<span class="o">=</span><span class="s1">'{"apiVersion": "v1", "spec": {"unschedulable": false}}'</span>
</code></pre>
</div>

<p>If you deleted the node’s VM instance and created a new one, then a new schedulable node resource will
be created automatically when you create a new VM instance (if you’re using a cloud provider that supports
node discovery; currently this is only Google Compute Engine, not including CoreOS on Google Compute Engine using kube-register). See <a href="/docs/admin/node">Node</a> for more details.</p>

<h2 id="advanced-topics">Advanced Topics</h2>

<h3 id="upgrading-to-a-different-api-version">Upgrading to a different API version</h3>

<p>When a new API version is released, you may need to upgrade a cluster to support the new API version (e.g. switching from ‘v1’ to ‘v2’ when ‘v2’ is launched)</p>

<p>This is an infrequent event, but it requires careful management. There is a sequence of steps to upgrade to a new API version.</p>

<ol>
  <li>Turn on the new api version.</li>
  <li>Upgrade the cluster’s storage to use the new version.</li>
  <li>Upgrade all config files. Identify users of the old API version endpoints.</li>
  <li>Update existing objects in the storage to new version by running <code class="highlighter-rouge">cluster/update-storage-objects.sh</code>.</li>
  <li>Turn off the old API version.</li>
</ol>

<h3 id="turn-on-or-off-an-api-version-for-your-cluster">Turn on or off an API version for your cluster</h3>

<p>Specific API versions can be turned on or off by passing –runtime-config=api/  <version> flag while bringing up the API server. For example: to turn off v1 API, pass `--runtime-config=api/v1=false`. runtime-config also supports 2 special keys: api/all and api/legacy to control all and legacy APIs respectively. For example, for turning off all api versions except v1, pass `--runtime-config=api/all=false,api/v1=true`. For the purposes of these flags, _legacy_ APIs are those APIs which have been explicitly deprecated (e.g. `v1beta3`).</version>
</p>

<h3 id="switching-your-clusters-storage-api-version">Switching your cluster’s storage API version</h3>

<p>The objects that are stored to disk for a cluster’s internal representation of the Kubernetes resources active in the cluster are written using a particular version of the API.
When the supported API changes, these objects may need to be rewritten in the newer API.  Failure to do this will eventually result in resources that are no longer decodable or usable
by the kubernetes API server.</p>

<p><code class="highlighter-rouge">KUBE_API_VERSIONS</code> environment variable for the <code class="highlighter-rouge">kube-apiserver</code> binary which controls the API versions that are supported in the cluster. The first version in the list is used as the cluster’s storage version. Hence, to set a specific version as the storage version, bring it to the front of list of versions in the value of <code class="highlighter-rouge">KUBE_API_VERSIONS</code>.  You need to restart the <code class="highlighter-rouge">kube-apiserver</code> binary
for changes to this variable to take effect.</p>

<h3 id="switching-your-config-files-to-a-new-api-version">Switching your config files to a new API version</h3>

<p>You can use the <code class="highlighter-rouge">kube-version-change</code> utility to convert config files between different API versions.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>hack/build-go.sh cmd/kube-version-change
<span class="gp">$ </span>_output/local/go/bin/kube-version-change -i myPod.v1beta3.yaml -o myPod.v1.yaml
</code></pre>
</div>

        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/admin/cluster-management.md?pixel" alt="Analytics" /></a>
        <div id="pd_rating_holder_8345992"></div>
		<script type="text/javascript">
        PDRTJS_settings_8345992 = {
        "id" : "8345992",
        "unique_id" : "/docs/admin/cluster-management/",
        "title" : "Cluster Management Guide",
        "permalink" : "http://kubernetes.github.io/docs/admin/cluster-management/"
        };
        (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
        </script>
	</div>
</section>

<footer>
	<main class="light-text">
		<nav>
			<a href="/docs/hellonode/">Get Started</a>
			<a href="/docs/">Documentation</a>
			<a href="http://blog.kubernetes.io/">Blog</a>
			<a href="/community/">Community</a>
		</nav>
		<div class="social">
			<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
			<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
			<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
			<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
			<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
			<a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
			<label for="wishField">I wish this page <input type="text" id="wishField" name="wishField" placeholder="enter your wish"></label>
		</div>
		<div class="center">&copy; 2016 Kubernetes</div>
	</main>
</footer>



<style>
	.cse .gsc-control-cse, .gsc-control-cse {
		padding: 0;
	}

	.gsc-above-wrapper-area {
		border-bottom: 0;
	}
</style>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-36037335-10', 'auto');
  ga('send', 'pageview');
</script>
<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
<!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->
-->
</body>
</html>